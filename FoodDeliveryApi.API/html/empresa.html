<!-- archivo: empresa.html -->
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Panel Empresa</title>
</head>

<body>
  <!-- <h2>Pedidos de la Empresa</h2>
  <input type="text" id="idEmpresa" placeholder="ID Empresa (GUID)">
  <button onclick="cargarPedidos()">Cargar Pedidos</button>
  <ul id="listaPedidos"></ul>

  <h3>Actualizar Estado de Pedido</h3>
  <form id="updateForm">
    <input type="number" id="idPedido" placeholder="ID Pedido" required><br>
    <select id="estado">
      <option value="0">Pendiente</option>
      <option value="1">EnPreparacion</option>
      <option value="2">EnCamino</option>
      <option value="3">Entregado</option>
      <option value="4">Cancelado</option>
    </select><br>
    <button type="submit">Actualizar Estado</button>
  </form>
  <div id="respuestaUpdate"></div>

  <script>
    async function cargarPedidos() {
      const idEmpresa = document.getElementById('idEmpresa').value;
      const res = await fetch(`http://localhost:5012/api/pedidos/empresa/${idEmpresa}`);
      const pedidos = await res.json();
      const lista = document.getElementById('listaPedidos');
      lista.innerHTML = '';
      pedidos.forEach(p => {
        const li = document.createElement('li');
        li.innerText = `Pedido #${p.idPedido} - Estado: ${p.estado} - Total: $${p.totalPedido}`;
        lista.appendChild(li);
      });
    }

    document.getElementById('updateForm').onsubmit = async function(e) {
      e.preventDefault();
      const idPedido = document.getElementById('idPedido').value;
      const estado = parseInt(document.getElementById('estado').value);
      const data = { estado: estado };
      const res = await fetch(`http://localhost:5012/api/pedidos/${idPedido}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      document.getElementById('respuestaUpdate').innerText = await res.text();
    };
  </script> -->

  <h2>Crear Empresa</h2>
  <form id="formEmpresa">
    <input type="text" id="nombre" placeholder="Nombre" required><br>
    <input type="text" id="direccion" placeholder="Dirección" required><br>
    <input type="text" id="telefono" placeholder="Teléfono" required><br>
    <input type="email" id="email" placeholder="Email" required><br>
    <input type="text" id="usuario" placeholder="Usuario" required><br>
    <input type="password" id="password" placeholder="Contraseña" required><br>
    <button type="submit">Crear Empresa</button>
  </form>
  <pre id="respuestaEmpresa"></pre>

  <script>
    document.getElementById('formEmpresa').onsubmit = async function (e) {
      e.preventDefault();
      const data = {
        nombre: document.getElementById('nombre').value,
        direccion: document.getElementById('direccion').value,
        telefono: document.getElementById('telefono').value,
        email: document.getElementById('email').value,
        usuario: document.getElementById('usuario').value,
        password: document.getElementById('password').value
      };
      const res = await fetch('http://localhost:5012/api/Empresas', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const respuesta = await res.json();
      document.getElementById('respuestaEmpresa').textContent = JSON.stringify(respuesta, null, 2);
    };
  </script>
<br><br>
  <h2>Empresas Registradas</h2>
  <button onclick="consultarEmpresas()">Consultar Empresas</button>
  <ul id="listaEmpresas"></ul>

  <script>
    async function consultarEmpresas() {
      const res = await fetch('http://localhost:5012/api/Empresas');
      const empresas = await res.json();
      const lista = document.getElementById('listaEmpresas');
      lista.innerHTML = '';
      empresas.forEach(e => {
        const li = document.createElement('li');
        li.innerText = `Empresa: ${e.nombre} - ID: ${e.idEmpresa}`;
        lista.appendChild(li);
      });
    }
  </script>
</body>
</html>