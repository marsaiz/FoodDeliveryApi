<!-- archivo: empresa.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Empresa</title>
</head>
<body>
  <h2>Pedidos de la Empresa</h2>
  <input type="text" id="idEmpresa" placeholder="ID Empresa (GUID)">
  <button onclick="cargarPedidos()">Cargar Pedidos</button>
  <ul id="listaPedidos"></ul>

  <h3>Actualizar Estado de Pedido</h3>
  <form id="updateForm">
    <input type="number" id="idPedido" placeholder="ID Pedido" required><br>
    <select id="estado">
      <option value="0">Pendiente</option>
      <option value="1">EnPreparacion</option>
      <option value="2">EnCamino</option>
      <option value="3">Entregado</option>
      <option value="4">Cancelado</option>
    </select><br>
    <button type="submit">Actualizar Estado</button>
  </form>
  <div id="respuestaUpdate"></div>

  <script>
    async function cargarPedidos() {
      const idEmpresa = document.getElementById('idEmpresa').value;
      const res = await fetch(`http://localhost:5012/api/pedidos/empresa/${idEmpresa}`);
      const pedidos = await res.json();
      const lista = document.getElementById('listaPedidos');
      lista.innerHTML = '';
      pedidos.forEach(p => {
        const li = document.createElement('li');
        li.innerText = `Pedido #${p.idPedido} - Estado: ${p.estado} - Total: $${p.totalPedido}`;
        lista.appendChild(li);
      });
    }

    document.getElementById('updateForm').onsubmit = async function(e) {
      e.preventDefault();
      const idPedido = document.getElementById('idPedido').value;
      const estado = parseInt(document.getElementById('estado').value);
      const data = { estado: estado };
      const res = await fetch(`http://localhost:5012/api/pedidos/${idPedido}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      document.getElementById('respuestaUpdate').innerText = await res.text();
    };
  </script>
</body>
</html>